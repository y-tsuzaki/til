# パイプしたときの終了ステータスの取得方法

Linux(Unix)では、すべてのコマンドはexit codeを返す。
0が成功、それ以上はエラーだ。

しかしパイプやリダイレクトが行われている場合、
途中のエラーは拾えるだろうか。

## パイプの終了ステータス

```
# exit 2 | exit 1 | exit 0
```
こういうケース。
通常通り`# echo $?`とすると、`0（正常終了）``が返ってしまう。

パイプ元でエラーが発生していても正常終了扱いになってしまうので注意が必要だ。

解決策は２つある。
どちらも、/bin/shには存在しないっぽいので、
使えるシェルであるかは注意すること。
Bash,Zshでは使える模様。

### PIPESTATUS

```
# exit 2 | exit 1 | exit 0
# echo  ${PIPESTATUS[@]}
2 1 0
```
PIPESTATUSという配列変数で取得できる。

### set -o pipefail

pipefailを有効にすると、Pipeでエラーが有ったときそのエラーコードを返してくれる。

```
# set -o pipefail
# exit 2 | exit 1 | exit 0
# echo $?
2
```

上記以外の方法もあるようだが、正直なかなか面倒そうに感じた。

## リダイレクトの終了ステータス。

リダイレクト元かリダイレクト先のどちらかが終了したら、終了する。
終了ステータスも、そのステータスになる。

